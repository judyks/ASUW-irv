<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      ASUW IRV (Instant-Runoff Voting) Software for Student Government Elections
    </title>

    <script>
      // INTERFACE
    </script>
  </head>
  <body>
    <input type="file" id="csvFileInput" accept=".csv" />
    <script>
      document
        .getElementById("csvFileInput")
        .addEventListener("change", handleFileSelect);

      function handleFileSelect(event) {
        const file = event.target.files[0];

        if (file) {
          const reader = new FileReader();

          reader.onload = function (e) {
            const csvData = e.target.result;
            const parsedData = parseCSV(csvData);
            console.log(parsedData);
            window.parsedData = parsedData;
            const fileName = generateFileName();
            console.log("Generated Filename:", fileName);
          };

          reader.readAsText(file);
        }
      }

      function parseCSV(csv) {
        let rows = csv.split("\n");

        if (rows.length < 2) {
          throw new Error("CSV data is empty or incomplete.");
        }

        let header = rows[0].split(",");
        let columns = header.map((column) => column.trim() + "");

        csvData = [];

        for (let i = 1; i < rows.length; i++) {
          if(rows[i].length == 0) continue;

          // start from 1 to skip header names
          const row = rows[i].split(",");

          // fill missing columns with empty string
          // (unanswered or empty optional questions)
          // TODO: Would it be better to throw error??
          while (row.length < columns.length) {
            row.push("");
          }

          // This is equal to the info in individual cells
          const rowData = {};

          for (let j = 0; j < columns.length; j++) {
            rowData[columns[j]] = row[j].trim();
          }

          csvData.push(rowData);
        }

        return csvData;
      }

      function generateFileName() {
        return new Date().toISOString().replace(/:/g, "-");
      }
    </script>
  </body>
</html>
